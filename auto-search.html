<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icon/iron-icon.html">



<dom-module id="auto-search">
    <style>
        :host {
            /*border: 1px solid silver;*/
            /*padding:3px;*/
            /*vertical-align: top;*/
            margin: 0;
            padding: 0;
            /*height:200px;*/
            /*width:800px;*/
        }

        :host.focus table {
            border: 1px solid #00a;
        }

        :host.focus .icon .search {
            color: #00a;
            color: var(--color-ba, #00a);
        }

        table {
            -webkit-border-radius: 3px;
            border: 1px solid silver;
            width: 800px;
            height: 100px;
            /*            height: var(--height);*/
        }

        td {
            padding: 0;
            margin: 0;
        }

        .icon {
            width: 1px;
        }

        .icon iron-icon {
            width: 100px;
            height: 100px;
            /*                        --iron-icon-height: var(--height);*/
        }

        #cancel {
            color: silver;
        }

        #search {
            border: none;
            outline: none;
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            font-size: 50px;
        }
        /*                ::-webkit-input-placeholder{color: silver;}*/
        /*                core-field /deep/ #cancel{color:silver;}
                *{
                    font-family: Roboto;
                    font-weight: 300;
                }
*/
    </style>


    <template>

        <table>
            <tr>
                <td class='icon'>
                    <iron-icon class='search' icon="search"></iron-icon>
                </td>
                <td>
                    <input id='search' is='iron-input' on-keyup='startTimer' placeholder="Search..." flex bind-value='{{liveValue}}' autofocus='true' on-focus="focus" on-blur="blur">
                </td>
                <td class='icon'>
                    <iron-icon id='cancel' icon="cancel" hidden$='{{!liveValue.length}}' on-tap='clearValue'></iron-icon>
                </td>
            </tr>
        </table>

    </template>

</dom-module>


<script>
    Polymer({
        is: "auto-search",
        properties: {
            delay: {
                type: Number,
                value: 500
            },
            minLength: {
                type: Number,
                value: 4
            },
            value: {
                type: String,
                notify: true
            }
        },
        ready: function () {
            //                this.length = 0;
        },
        startTimer: function (ev) {
            if (ev.which == 13) this.update();
            this.length = this.$.search.value.length;
            if (this.$.search.value.length < this.minlength) return;

            this.debounce('search-job', this.update.bind(this), this.delay);
        },
        update: function () {
            this.value = this.liveValue;
            this.fire('search', this.value);
            this.updateStyles();
        },

        clearValue: function () {
            this.liveValue = '';
            this.update();
            this.$.search.focus();
        },

        focus: function () {
            this.toggleClass('focus', true);
            this.fire('focus', this.value);
        },
        blur: function () {
            this.toggleClass('focus', false);
        }

        //            could do it with a input[type=search]... but more difficult to style amongst browsers
        //             type='search' on-search="searchNow"
        //            searchNow: function () {
        //                console.log('search');
        //            }
    });
</script>
